---
title: "Chapter 3"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.





# Chapter 3. Data pre-processing 

## 3.1 Case study: cell segmentation in high-content screening 
## 3.2 Data transformation for individual predictors 

### Centering and scaling 
### Transformations to resolve skewness

## 3.3 Data transformation for multiple predicors 

### Transformations to resolve outliers 
### Data reduction and feature extraction

## 3.4 Dealing with missing values 

### Imputation

## 3.5 Removing predictors 

### Zero variance predictor 
### Between predictor correlations 

## 3.6 Adding predictors 

### dummy variables 
### nonlinearality 

## 3.7 Binning predictors 


## 3.8 Computing 
```{r}
library(AppliedPredictiveModeling)
library(caret)
library(corrplot)
library(e1071)
library(lattice)
library(caret)
```

```{r}
apropos("confusion")
```

```{r}
RSiteSearch("confusion",restrict='function')
```
```{r}
data(segmentationOriginal)
segData <- subset(segmentationOriginal, Case=="Train")
```

```{r}
cellID <- segData$Cell
class <- segData$Class
case <- segData$Case
segData <- segData[,-(1:3)]
```

```{r}
statusColNum <- grep("Status",names(segData))
statusColNum
segData <- segData[,-statusColNum]
```

### Transformation 
```{r}
skewness(segData$AngleCh1)
```
```{r}
skewValues <- apply(segData, 2, skewness)
head(skewValues)
```

```{r}
Ch1AreaTrans <- BoxCoxTrans(segData$AreaCh1)
Ch1AreaTrans
```

```{r}
# The original data
head(segData$AreaCh1)
```
```{r}
# After transformation 
predict(Ch1AreaTrans, head(segData$AreaCh1))
```

```{r}
(819^(-0.9)-1)/(-0.9)
```

```{r}
pcaObject <- prcomp(segData, center=TRUE, scale. = TRUE)

# Calculate the cumulative percentage of variance which each component accounts for 
percentVariance <- pcaObject$sd^2/sum(pcaObject$sd^2)*100
percentVariance[1:3]
plot(percentVariance)
```
```{r}
# The transformed values are stored in pcaObject as a sub-object called x
head(pcaObject$x[,1:5])
```

```{r}
head(pcaObject$rotation[,1:3])
```

```{r}
SS <- spatialSign(segData)
plot(SS)
```

```{r}
trans <- preProcess(segData, method=c("BoxCox","center","scale","pca"))
trans
```

```{r}
# Apply the transformations
transformed <- predict(trans, segData)
# These values are different than the previous PCA components since they were transformed prior to PCA
head(transformed[,1:5])
```

```{r}
# The order in which the possible transformation are applied is transformation, centering, scaling, imputation, feature extraction, and then spatial sign.
```

### Filtering 

```{r}
nearZeroVar(segData)
```

```{r}
correlations <- cor(segData)
dim(correlations)
correlations[1:4,1:4]
```

```{r,fig.height=9,fig.width=9}
library(corrplot)
corrplot(correlations, order="hclust")
```

```{r}
highCorr <- findCorrelation(correlations, cutoff=.75)
length(highCorr)
head(highCorr)
filteredSegData <- segData[,-highCorr]
```


### Creating dummy variables 
```{r}
head(carSubset)
levels(carSubset$Type)
simpleMod <- dummyVars(~Mileage+Type, data=carSubset, levelsOnly=TRUE)
simpleMod

predict(simpleMod,head(carSubset))

withInteraction <- dummyVars(~Mileage + Type + Mileage:Type, data=carSubset, levelsOnly=TRUE)
withInteraction

predict(withInteraction, head(carSubset))

```


