---
title: "Chapter 8,9"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.





# Chapter 8. Regression Trees and Rule_Based Models

## 8.1 Basicregression trees  

## 8.2 Regression model trees

## 8.3 Rule-Based models 

## 8.4 Bagged trees

## 8.5 Random forests

## 8.6 Boosting 

## 8.7 Cubist 

## 8.8 Computing

### Single trees

```{r}
library(rpart)
library(party)
library(caret)
```

```{r}
rpartTree <- rpart(y ~. , data = trainData)
ctreeTree <- ctree(y ~., data = trainData)
```

```{r}
set.seed(100)
rpartTune <- train(solTrainXtrans, solTrainY, 
                   method = "rpart2", tuneLength = 10, trControl = trainControl(method = "cv"))
```

```{r}
plot(rpartTune)
```

```{r}
library(partykit)
rpartTree2 <- as.party(rpartTree)
plot(rpartTree2)
```


### Model trees

```{r}
library(rJava)
library(RWeka)
m5tree <- M5P(y ~., data = trainData)
m5rules <- M5Rules(y ~., data = trainData)

m5tree <- M5P(y~., data = trainData, control = Weka_control(M = 10))
```

```{r}
set.seed(100)
m5Tune <- train(solTrainXtrans, solTrainY, 
                method = "M5", trControl = trainControl(method = "cv"), 
                # use an option for M5() to specify the minimum number of samples needed to further splits the data 
                # to be 10
                control = Weka_control(M = 10))
```


### Bagged trees

```{r}
library(ipred)
baggedTree <- ipredbagg(solTrainY, soltrainXtrans)
baggedTree <- bagging(y ~., data = trainData)
```

```{r}
library(party)
# The mtry parameter should be the number of predictors (the number of columns minus 1 for the outcome)
bagCtrl <- cforest_control(mtry = ncol(trainData) - 1)
baggedTree <- cforest(y ~., data = trainData, controls = bagCtrl)
```


### Random forest

```{r}
library(randomForest)
rfModel <- randomForest(solTrainXtrans, solTrainY)
plot(rfModel)
rfModel <- randomForest(y~., data = trainData)
```

```{r}
rfModel <- randomForest(solTrainXtrans, solTrainY, importance = TRUE, ntrees = 1000)
plot(rfModel)
```

```{r}
varImp(rfModel)
plot(varImp(rfModel))
```


### Boosted trees

```{r}
library(gbm)
gbmModel <- gbm.fit(solTrainXtrans, solTrainY, distribution = "gaussian")
gbmModel <- gbm(y~., data = trainData, distribution = "gaussian")
```

```{r}
gbmGrid <- expand.grid(.interaction.depth=seq(1,7,by=2), .n.trees = seq(100, 1000, by = 50),
                       .shrinkage = c(0.01, 0.1), .n.minobsinnode)
set.seed(100)
gbmTune <- train(solTrainXtrans, solTrainY, method = "gbm", tuneGrid = gbmGrid,
                 # The gbm() function produces copious amounts of output, so pass in the verbose option to avoid 
                 # printing a lot to the screen
                 verbose = FALSE)
```


### Cubist 
```{r}
library(Cubist)
cubistMod <- cubist(solTrainXtrans, solTrainY)
predict(cubistMod, solTestXtrans)
cubistTuned <- train(solTrainXtrans, solTrainY, method = "cubist")
```



# Chapter 9. A Summary of Solubility Models 
